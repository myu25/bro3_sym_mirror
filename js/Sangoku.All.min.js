(function(){var br={name:'S2',version:'2.4.4',copyright:'(c) 2011 (･ω･っ)3, 69n66',notes:"コピー、改変、再配布禁止！以前のバージョンも同様！ Don't copy it!"};var W=window,D=W.document,L=MJ.parseUri(location.href),C=MJ.cookie(),$v=MJ.valid;var S=MJ.extend(MJ.sub({init:function(){},serialize:function(){},deserialize:function(){},set:function(){},copyFrom:function(o){this.init();if(o){switch(typeof o){case"string":this.deserialize(o);break;case"object":this.copy(o);break;default:throw"Cannot copy.";}}}}),{LOCATION:'http://3594.chew.jp/',IMAGES_ROOT:'http://69n6600.sakura.ne.jp',COOKIE_NAME:'sangoku',COOKIE_PATH:'',COOKIE_SIZE:3800,COOKIE_N:2,TARGET_GAME:'b3',UNTITLE_KYOTEN:'名称未設定',DELETE_CONFIRM_SURFIX:' を削除します。',TERM_SELECT_SERFIX:'期',LINK_BBS_SURFIX:'の掲示板',HEIKA:{ho:0,yari:1,yumi:2,uma:3},HEISHU:{ken:0,yari_1:1,yari_2:2,yumi_1:3,yumi_2:4,uma_1:5,uma_2:6,heiki_1:7,heiki_2:8,spy_1:9,spy_2:10},OTHERS:{wood:0,stone:1,iron:2,rice:3,build:4},HEIKA_KEYS:["ho","yari","yumi","uma"],HEISHU_KEYS:["ken","yari_1","yari_2","yumi_1","yumi_2","uma_1","uma_2","heiki_1","heiki_2","spy_1","spy_2"],OTHERS_KEYS:["wood","stone","iron","rice","build"],HEI:{ken:{heika:"ho",exp:1,wood:10,stone:0,iron:10,rice:60,atk:15,def_ho:15,def_yari:10,def_yumi:10,def_uma:10,spd:6},yari_1:{heika:"yari",exp:2,wood:88,stone:132,iron:0,rice:20,atk:40,def_ho:50,def_yari:40,def_yumi:25,def_uma:55,spd:7},yari_2:{heika:"yari",exp:4,wood:264,stone:396,iron:0,rice:60,atk:100,def_ho:200,def_yari:100,def_yumi:63,def_uma:137,spd:10},yumi_1:{heika:"yumi",exp:2,wood:144,stone:0,iron:96,rice:35,atk:42,def_ho:52,def_yari:58,def_yumi:42,def_uma:26,spd:5},yumi_2:{heika:"yumi",exp:4,wood:432,stone:0,iron:288,rice:105,atk:105,def_ho:208,def_yari:145,def_yumi:105,def_uma:65,spd:8},uma_1:{heika:"uma",exp:2,wood:0,stone:128,iron:192,rice:40,atk:44,def_ho:54,def_yari:28,def_yumi:60,def_uma:44,spd:12},uma_2:{heika:"uma",exp:4,wood:0,stone:384,iron:576,rice:120,atk:110,def_ho:216,def_yari:70,def_yumi:150,def_uma:110,spd:15},heiki_1:{heika:"ho",exp:2,wood:500,stone:0,iron:500,rice:0,atk:15,def_ho:10,def_yari:10,def_yumi:10,def_uma:10,spd:3},heiki_2:{heika:"ho",exp:4,wood:0,stone:1500,iron:1500,rice:0,atk:30,def_ho:15,def_yari:15,def_yumi:15,def_uma:15,spd:6},spy_1:{heika:"ho",exp:1,wood:150,stone:150,iron:150,rice:10,atk:0,def_ho:10,def_yari:10,def_yumi:5,def_uma:5,spd:9},spy_2:{heika:"uma",exp:2,wood:450,stone:450,iron:450,rice:30,atk:0,def_ho:30,def_yari:10,def_yumi:40,def_uma:20,spd:20}},BUKI:{ken:{0:0,1:0.1,2:0.2,3:0.3,4:0.4,5:0.5,6:0.6,7:0.75,8:0.9,9:1.1,10:1.35},yari_1:{0:0,1:0.05,2:0.1,3:0.16,4:0.22,5:0.30,6:0.38,7:0.48,8:0.58,9:0.68,10:0.8},yari_2:{0:0,1:0.04,2:0.08,3:0.12,4:0.16,5:0.20,6:0.24,7:0.28,8:0.33,9:0.38,10:0.45},yumi_1:{0:0,1:0.05,2:0.1,3:0.16,4:0.22,5:0.30,6:0.38,7:0.48,8:0.58,9:0.68,10:0.8},yumi_2:{0:0,1:0.04,2:0.08,3:0.12,4:0.16,5:0.20,6:0.24,7:0.28,8:0.33,9:0.38,10:0.45},uma_1:{0:0,1:0.05,2:0.1,3:0.16,4:0.22,5:0.30,6:0.38,7:0.48,8:0.58,9:0.68,10:0.8},uma_2:{0:0,1:0.04,2:0.08,3:0.12,4:0.16,5:0.20,6:0.24,7:0.28,8:0.33,9:0.38,10:0.45},heiki_1:{0:0,1:0.03,2:0.06,3:0.09,4:0.12,5:0.15,6:0.18,7:0.21,8:0.25,9:0.29,10:0.35},heiki_2:{0:0,1:0.05,2:0.1,3:0.15,4:0.21,5:0.28,6:0.36,7:0.45,8:0.56,9:0.69,10:0.85},spy_1:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0},spy_2:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0}},YOROI:{ken:{0:0,1:0.15,2:0.3,3:0.45,4:0.6,5:0.75,6:0.9,7:1.1,8:1.3,9:1.55,10:1.85},yari_1:{0:0,1:0.05,2:0.1,3:0.16,4:0.22,5:0.30,6:0.38,7:0.48,8:0.58,9:0.68,10:0.8},yari_2:{0:0,1:0.04,2:0.06,3:0.10,4:0.13,5:0.16,6:0.19,7:0.24,8:0.27,9:0.30,10:0.35},yumi_1:{0:0,1:0.05,2:0.1,3:0.16,4:0.22,5:0.30,6:0.38,7:0.48,8:0.58,9:0.68,10:0.8},yumi_2:{0:0,1:0.04,2:0.06,3:0.10,4:0.13,5:0.16,6:0.19,7:0.24,8:0.27,9:0.30,10:0.35},uma_1:{0:0,1:0.05,2:0.1,3:0.16,4:0.22,5:0.30,6:0.38,7:0.48,8:0.58,9:0.68,10:0.8},uma_2:{0:0,1:0.04,2:0.06,3:0.10,4:0.13,5:0.16,6:0.19,7:0.24,8:0.27,9:0.30,10:0.35},heiki_1:{0:0,1:0.03,2:0.06,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0},heiki_2:{0:0,1:0.05,2:0.1,3:0.15,4:0.2,5:0,6:0,7:0,8:0,9:0,10:0},spy_1:{0:0,1:0.03,2:0.06,3:0.1,4:0.15,5:0.2,6:0.25,7:0.35,8:0.4,9:0.45,10:0.6},spy_2:{0:0,1:0.03,2:0.06,3:0.1,4:0.13,5:0.16,6:0.19,7:0.24,8:0.27,9:0.3,10:0.35}},MAKE:{ken:{0:0,1:291,2:233,3:187,4:149,5:120,6:96,7:77,8:62,9:49,10:40},yari_1:{0:0,1:1342,2:1074,3:859,4:688,5:550,6:440,7:352,8:282,9:226,10:181,11:145,12:116,13:93,14:74,15:60},yari_2:{0:0,1:1797,2:1438,3:1151,4:921,5:737,6:589,7:472,8:377,9:302,10:242,11:193,12:155,13:124,14:99,15:80},yumi_1:{0:0,1:1342,2:1074,3:859,4:688,5:550,6:440,7:352,8:282,9:226,10:181,11:145,12:116,13:93,14:74,15:60},yumi_2:{0:0,1:1797,2:1438,3:1151,4:921,5:737,6:589,7:472,8:377,9:302,10:242,11:193,12:155,13:124,14:99,15:80},uma_1:{0:0,1:1438,2:1151,3:921,4:737,5:589,6:472,7:377,8:302,9:242,10:193,11:155,12:124,13:99,14:80,15:64},uma_2:{0:0,1:1980,2:1584,3:1268,4:1014,5:812,6:649,7:520,8:416,9:333,10:266,11:213,12:171,13:137,14:109,15:88},heiki_1:{0:0,1:6000,2:4800,3:3841,4:3073,5:2458,6:1967,7:1573,8:1259,9:1007,10:806,11:645,12:516,13:413,14:330,15:264},heiki_2:{0:0,1:12000,2:9600,3:7681,4:6145,5:4916,6:3933,7:3146,8:2517,9:2014,10:1611,11:1289,12:1031,13:825,14:660,15:528},spy_1:{0:0,1:900,2:720,3:577,4:461,5:369,6:295,7:236,8:189,9:151,10:121},spy_2:{0:0,1:2400,2:1920,3:1537,4:1229,5:984,6:787,7:630,8:504,9:403,10:323,11:258,12:207,13:165,14:132,15:106}},KAJIYA:{0:0,1:0,2:0.015,3:0.03,4:0.045,5:0.06,6:0.075,7:0.09,8:0.105,9:0.12,10:0.15},BOUGUYA:{0:0,1:0,2:0.015,3:0.03,4:0.045,5:0.06,6:0.075,7:0.09,8:0.105,9:0.12,10:0.15},KUNREN:{0:0,1:0.05,2:0.1,3:0.15,4:0.2,5:0.25,6:0.3,7:0.35,8:0.4,9:0.45,10:0.5},ENSEI:{0:0,1:0.001,2:0.002,3:0.003,4:0.004,5:0.005,6:0.006,7:0.007,8:0.008,9:0.009,10:0.01,11:0.011,12:0.012,13:0.013,14:0.014,15:0.015,16:0.016,17:0.017,18:0.018,19:0.019,20:0.02},RYOUTI:{0:1,1:1,2:1.2,3:1.4,4:1.6,5:2},LV_MAX:400,Data:{bushodas:{},skill:{},npc:[]}});var bs=["id","name","kana","note","img","rare_num","zoku_num","cost","heika_num","atk","int","def_ho","def_yari","def_yumi","def_uma","spd","sid","slv","atk_sid","int_sid","def_sid","sec_sid"],b_property_l=bs.length;S.Bushodas=S.sub(function(){var i=0,l=arguments.length;for(;i<b_property_l&&i<l;i++){this[bs[i]]=arguments[i]}},{getHeika:function(){return S.HEIKA_KEYS[this.heika_num]},getRare:function(){switch(this.rare_num){case-1:return"UR";case 0:return"SR";case 1:return"R";case 2:return"UC";default:return"C"}},getShozoku:function(){switch(this.zoku_num){case 0:return"魏";case 1:return"呉";case 2:return"蜀";default:return"他"}}});var bt=["id","name","kana","note","type","effect_statements","descs"],s_property_l=bt.length;S.Skill=S.sub(function(){var i=0,l=arguments.length;for(;i<s_property_l&&i<l;i++){this[bt[i]]=arguments[i]}this.effects={}},{isDomestic:function(){return(parseInt(this.type,10)>=100)},hasStatement:function(a){var i;if(a){if(this.effect_statements[a]){return true}}else{for(i=1;i<=10;i++){if(this.effect_statements[i]){return true}}}return false},getEffect:new Function("_slv","_b","_p","			var	statement = this.effect_statements[ _slv ],				effect = this.effects[ _slv ];			if ( statement ) {				if ( effect ) {					effect.clear();				} else {					effect = this.effects[ _slv ] = new "+br.name+".Effect();				}				with ( effect ) {					var cost		= _b.getCost(),						int			= _b.getInt(),						ap			= _b.ap,						ip			= _b.ip,						dp			= _b.dp,						sp			= _b.sp,						kyoshu		= _p.kyoshu,						kyori		= _p.kyori,						ally		= _p.ally,						rinsetu		= _p.rinsetu,						offence_n	= _p.offence.hei_nums,						deffence_n	= _p.deffence.hei_nums;					eval( statement );				}				return effect;			}		")});var bu=["name","term","lv","is_npc","ken","yari_1","yumi_1","uma_1","yari_2","yumi_2","uma_2","spy_1","spy_2"],n_property_l=bu.length;S.Npc=S.sub(function(){var i=0,l=arguments.length;for(;i<n_property_l&&i<l;i++){this[bu[i]]=arguments[i]}},{getN:function(a,b,c){if(a==='heiki_1'||a==='heiki_2'){return 0}else{return this.is_npc?this[a]:Math.floor((this[a]+this[a]*b/10)*c)}}});S.Gun=(function(){var q=[["INT",0]],v_heishu=[["IN_ARRAY",S.HEISHU_KEYS]];return S.sub({init:function(){var i;if(this.hei_nums){this.domestic_busho.clear();this.kyoten.clear();for(i in this.hei_nums){this.hei_nums[i]=0}}else{this.domestic_busho=new S.Busho();this.kyoten=new S.Kyoten();this.hei_nums={ken:0,yari_1:0,yari_2:0,yumi_1:0,yumi_2:0,uma_1:0,uma_2:0,heiki_1:0,heiki_2:0,spy_1:0,spy_2:0}}},set:function(a){switch(a){case"hei_nums":var b=$v(arguments[1],v_heishu);this.hei_nums[b]=$v(arguments[2],q);return this.hei_nums[b];default:throw'Unknown property. [ S.Busho.set("'+a+'") ]';}},getAtk:function(a){var i,r=0;if(a){for(i in S.HEISHU){r+=S.HEI[i].atk*this.hei_nums[i]*(a.getHeiEffect(i,"atk")+1)}}else{for(i in S.HEISHU){r+=S.HEI[i].atk*this.hei_nums[i]}}r+=this.attacker.getAtk(a);return r},getDef:function(a,b){var i,rel_def=0,offence_heika_nums=a.getHeikaNums();if(offence_heika_nums.total){var c=this.getHeikaDefs(b);for(i in S.HEIKA){rel_def+=c[i]*offence_heika_nums[i]/offence_heika_nums.total}}return rel_def},getHeikaNums:function(){var i,j,r={total:0,ho:0,yari:0,yumi:0,uma:0};for(i in S.HEISHU){r.total+=this.hei_nums[i];r[S.HEI[i].heika]+=this.hei_nums[i]}if(this.attacker){if(this.attacker.bushodas){r.total++;r[this.attacker.getHeika()]++}}else{var a=this.staying_bushos.concat([this.domestic_busho]);for(j in a){if(a[j].bushodas){r.total++;r[a[j].getHeika()]++}}}return r},getHeikaDefs:function(a){var i,j,r={ho:0,yari:0,yumi:0,uma:0};for(i in S.HEISHU){var b=a?a.getHeiEffect(i,"def")+1:1;r.ho+=S.HEI[i].def_ho*b*this.hei_nums[i];r.yari+=S.HEI[i].def_yari*b*this.hei_nums[i];r.yumi+=S.HEI[i].def_yumi*b*this.hei_nums[i];r.uma+=S.HEI[i].def_uma*b*this.hei_nums[i]}if(this.attacker){var c=a?a.getBushoEffect(this.attacker.getHeika(),"def")+1:1;r.ho+=this.attacker.getDef("ho")*c;r.yari+=this.attacker.getDef("yari")*c;r.yumi+=this.attacker.getDef("yumi")*c;r.uma+=this.attacker.getDef("uma")*c}else{var d=this.staying_bushos.concat([this.domestic_busho]);for(j in d){var e=a?a.getBushoEffect(d[j].getHeika(),"def")+1:1;r.ho+=d[j].getDef("ho")*e;r.yari+=d[j].getDef("yari")*e;r.yumi+=d[j].getDef("yumi")*e;r.uma+=d[j].getDef("uma")*e}}return r},getSongaiNums:function(a,b){var i,j,k,l,r={};var c=this.getHeikaNums();var d=this.getHeikaDefs(b);var e={};var f=c.total*a;while(true){var g=0;for(i in S.HEIKA){if(e[i]===undefined){g+=d[i]}}if(g){var h=false;var m={};for(j in S.HEIKA){if(e[j]===undefined){var n=f*d[j]/g;if(n>=c[j]){f-=c[j];e[j]=c[j];h=true}else{m[j]=n}}}if(!h){for(k in m){e[k]=m[k]}break}}else{break}}for(l in S.HEISHU){var o=S.HEI[l].heika;var p=c[o];r[l]=p?Math.round(this.hei_nums[l]*e[o]/p):0}return r}})})();S.Offence=S.Gun.sub(function(o){this.copyFrom(o)},{init:function(){S.Gun.prototype.init.apply(this);if(this.attacker){this.attacker.clear()}else{this.attacker=new S.Busho()}},serialize:function(){var i,arr=[2,this.attacker.serialize(),this.domestic_busho.serialize(),this.kyoten.serialize()];for(i in S.HEISHU){arr.push(this.hei_nums[i])}return arr.join("_")},deserialize:function(a){var i,arr=a.split("_");switch(parseInt(arr.shift(),10)){case 1:this.attacker.copyFrom(arr.shift());this.kyoten.copyFrom(arr.shift());this.offence_kakin=arr.shift()?true:false;for(i in S.HEISHU){this.set("hei_nums",i,arr.shift())}break;case 2:this.attacker.copyFrom(arr.shift());this.domestic_busho.copyFrom(arr.shift());this.kyoten.copyFrom(arr.shift());for(i in S.HEISHU){this.set("hei_nums",i,arr.shift())}break;default:break}}});S.Deffence=S.Gun.sub(function(o){this.copyFrom(o)},{init:function(){S.Gun.prototype.init.apply(this);this.staying_bushos=[]},serialize:function(){var i,arr=[2,this.domestic_busho.serialize(),this.kyoten.serialize()];for(i in S.HEISHU){arr.push(this.hei_nums[i])}return arr.join("_")},deserialize:function(a){var i,arr=a.split("_");switch(parseInt(arr.shift(),10)){case 1:this.domestic_busho.copyFrom(arr.shift());this.kyoten.copyFrom(arr.shift());this.deffence_kakin=arr.shift()?true:false;for(i in S.HEISHU){this.set("hei_nums",i,arr.shift())}break;case 2:this.domestic_busho.copyFrom(arr.shift());this.kyoten.copyFrom(arr.shift());for(i in S.HEISHU){this.set("hei_nums",i,arr.shift())}break;default:break}}});S.Busho=(function(){var d=["bid","sid","lv","ap","ip","dp","sp","hp","skill_lv","toubatu"],serialize_order_v2=["bid","sid","lv","ap","ip","dp","sp","skill_lv","pname"],v_int_0=[["INT",0]],v_int_0_100=[["INT",0,100]],v_int_0_500=[["INT",0,500]],v_int_point=[["INT",0,S.LV_MAX*5]],v_int_lv=[["INT",0,S.LV_MAX]],v_int_slv=[["INT",1,10]],v_not_pname=[["NOT_MATCH",new RegExp("[-_~]")]],v_skill=[["INSTANCE_OF",S.Skill]],v_busho=[["INSTANCE_OF",S.Bushodas]];return S.sub(function(o){this.copyFrom(o)},{init:function(){this.bid=0;this.sid=0;this.lv=0;this.ap=0;this.ip=0;this.dp=0;this.sp=0;this.skill_lv=1;this.pname="";this.toubatu=500;this.hp=100;this.bushodas=undefined;this.skill=undefined},copyFrom:function(){S.prototype.copyFrom.apply(this,arguments);this._serialize();this.dispatch('update_b')},serialize:function(){return this._serialized||this._serialize()},_serialize:function(){var i,arr=[2];for(i in serialize_order_v2){arr.push(this[serialize_order_v2[i]])}this._serialized=arr.join("-");return this._serialized},deserialize:function(a){var i,order,arr=a.split("-");switch(parseInt(arr.shift(),10)){case 1:order=d;break;case 2:order=serialize_order_v2;break;default:break}for(i in order){if(arr.length){this._set(order[i],arr.shift())}}},set:function(){this._set.apply(this,arguments);this._serialize();this.dispatch('update_b')},_set:function(a){switch(a){case"pname":this.pname=$v(arguments[1],v_not_pname);return this.pname;case"sid":this.sid=$v(arguments[1],v_int_0);this._set("skill",S.Data.skill[this.sid]||0);return this.sid;case"bid":this.bid=$v(arguments[1],v_int_0);this._set("bushodas",S.Data.bushodas[this.bid]||0);return this.bid;case"ap":case"ip":case"dp":case"sp":this[a]=$v(arguments[1],v_int_point);return this[a];case"lv":this.lv=$v(arguments[1],v_int_lv);return this.lv;case"skill_lv":this.skill_lv=$v(arguments[1],v_int_slv);return this.skill_lv;case"skill":if(arguments[1]){this.skill=$v(arguments[1],v_skill);this.sid=this.skill.id}else{delete this.skill}return this.skill;case"bushodas":if(arguments[1]){this.bushodas=$v(arguments[1],v_busho);this.bid=this.bushodas.id}else{delete this.bushodas}return this.bushodas;case"hp":this.hp=$v(arguments[1],v_int_0_100);return this.hp;case"toubatu":this.toubatu=$v(arguments[1],v_int_0_500);return this.toubatu;default:throw'Unknown property. [ S.Busho.set("'+a+'") ]';}},getBonus:function(){return this.lv*5-(this.ap+this.ip+this.dp+this.sp)},getId:function(){return this.bushodas?this.bushodas.id:'0000'},getSkillId:function(){return this.skill?this.skill.id:undefined},getName:function(){return this.bushodas?this.bushodas.name:''},getRare:function(){return this.bushodas?this.bushodas.getRare():"C"},getHeika:function(){return this.bushodas?this.bushodas.getHeika():"ho"},getCost:function(){return this.bushodas?this.bushodas.cost:1},getImage:function(){return this.bushodas?S.IMAGES_ROOT+this.bushodas.img:''},getAtk:function(a){if(this.bushodas){var b=a?a.getBushoEffect(this.bushodas.getHeika(),'atk')+1:1;return(this.bushodas.atk+this.bushodas.atk*this.ap*0.094)*b}else{return 0}},getDef:function(a,b){if(this.bushodas){var c=b?b.getBushoEffect(this.bushodas.getHeika(),'def')+1:1;switch(a){case"ho":return(this.bushodas.def_ho+this.bushodas.def_ho*this.dp*0.094)*c;case"yari":return(this.bushodas.def_yari+this.bushodas.def_yari*this.dp*0.094)*c;case"yumi":return(this.bushodas.def_yumi+this.bushodas.def_yumi*this.dp*0.094)*c;case"uma":return(this.bushodas.def_uma+this.bushodas.def_uma*this.dp*0.094)*c;default:throw'Unknown heika. [ S.Busho.getDef("'+a+'") ]';}}else{return 0}},getInt:function(){return this.bushodas?this.bushodas.int+this.ip*this.bushodas.int*0.0016:0},getSpd:function(a){if(this.bushodas){var b=this.bushodas.spd+this.bushodas.spd*this.sp*0.012;var c=a?a.getBushoEffect(this.bushodas.getHeika(),'spd')+1:1;return b*c}else{return 0}},getSongaiHp:function(a,b){var c=parseInt(100*a,10);if(c>this.hp){return this.hp}if(b&&(this.hp-c)<=15){return this.hp}else{return c}},getLiveHp:function(a,b){return this.hp-this.getSongaiHp(a,b)},getRecoverSec:function(a){var b=0,die=100-a;if(die){if(this.lv<5){b=Math.pow(2,this.lv)*9*die}else if(this.lv<10){b=144*(this.lv-3)*die}else{b=(this.lv+20)*36*die}}return b},getAttackEffect:function(a){if(this.skill&&this.bushodas&&!this.skill.isDomestic()){return this.skill.getEffect(this.skill_lv,this,a)}},getDomesticEffect:function(a){if(this.skill&&this.bushodas&&this.skill.isDomestic()){return this.skill.getEffect(this.skill_lv,this,a)}},getLabel:function(){if(this.pname){return this.pname}else{return this.bushodas?this.getRare()+this.getName()+' Lv.'+this.lv:undefined}},hasBushodas:function(){return this.bushodas},clear:function(){this.init();this._serialize();this.dispatch('update_b')}})})();S.Kyoten=(function(){var d=[["NOT_MATCH",new RegExp("[-_~^]")]],v_int_0_10=[["INT",0,10]],v_int_0_15=[["INT",0,15]],v_int_0_20=[["INT",0,20]],v_heishu=[["IN_ARRAY",S.HEISHU_KEYS]];return S.sub(function(o){this.copyFrom(o)},{init:function(){this.renpeizyo_lv=0;this.heisha_lv=0;this.yumiheisha_lv=0;this.kyusha_lv=0;this.koubou_lv=0;this.kajiba_lv=0;this.bouguya_lv=0;this.kunren_lv=0;this.ensei_lv=0;this.buki_lvs={ken:0,yari_1:0,yari_2:0,yumi_1:0,yumi_2:0,uma_1:0,uma_2:0,heiki_1:0,heiki_2:0,spy_1:0,spy_2:0};this.yoroi_lvs={ken:0,yari_1:0,yari_2:0,yumi_1:0,yumi_2:0,uma_1:0,uma_2:0,heiki_1:0,heiki_2:0,spy_1:0,spy_2:0};this.pname="";this.effect=new S.Effect()},copyFrom:function(){S.prototype.copyFrom.apply(this,arguments);this._serialize();this.dispatch('update_k')},serialize:function(){return this._serialized||this._serialize()},_serialize:function(){var i,arr=[2,this.renpeizyo_lv,this.heisha_lv,this.yumiheisha_lv,this.kyusha_lv,this.koubou_lv,this.kajiba_lv,this.bouguya_lv,this.kunren_lv,this.ensei_lv];for(i in S.HEISHU){arr.push(this.buki_lvs[i])}for(i in S.HEISHU){arr.push(this.yoroi_lvs[i])}arr.push(this.pname);this._serialized=arr.join("-");return this._serialized},deserialize:function(a){var i,arr=a.split("-");switch(parseInt(arr.shift(),10)){case 2:this._set("pname",arr.pop());this._set("renpeizyo_lv",arr.shift());this._set("heisha_lv",arr.shift());this._set("yumiheisha_lv",arr.shift());this._set("kyusha_lv",arr.shift());this._set("koubou_lv",arr.shift());case 1:this._set("kajiba_lv",arr.shift());this._set("bouguya_lv",arr.shift());this._set("kunren_lv",arr.shift());this._set("ensei_lv",arr.shift());for(i in S.HEISHU){this._set("buki_lvs",i,arr.shift())}for(i in S.HEISHU){this._set("yoroi_lvs",i,arr.shift())}break;default:break}},set:function(){this._set.apply(this,arguments);this._serialize();this.dispatch('update_k')},_set:function(a){switch(a){case"pname":this.pname=$v(arguments[1],d);return this.pname;case"kajiba_lv":case"bouguya_lv":case"kunren_lv":case"renpeizyo_lv":this[a]=$v(arguments[1],v_int_0_10);return this[a];case"heisha_lv":case"yumiheisha_lv":case"kyusha_lv":case"koubou_lv":this[a]=$v(arguments[1],v_int_0_15);return this[a];case"ensei_lv":this[a]=$v(arguments[1],v_int_0_20);return this[a];case"buki_lvs":case"yoroi_lvs":var b=$v(arguments[1],v_heishu);this[a][b]=$v(arguments[2],v_int_0_10);return this[a][b];default:throw'Unknown property. [ S.Kyoten.set("'+a+'") ]';}},getEffect:function(a){var i,eh=this.effect.h;eh.all.atk=S.KAJIYA[this.kajiba_lv];eh.all.def=S.BOUGUYA[this.bouguya_lv];for(i in S.HEISHU){eh[i].atk=S.BUKI[i][this.buki_lvs[i]];eh[i].def=S.YOROI[i][this.yoroi_lvs[i]]}this.effect.all.spd=S.KUNREN[this.kunren_lv]+S.ENSEI[this.ensei_lv]*a.kyori;return this.effect},getMakeSec:function(a,b){var c=0;switch(a){case"ken":c=S.MAKE.ken[this.renpeizyo_lv];break;case"yari_1":c=S.MAKE.yari_1[this.heisha_lv];break;case"yari_2":c=S.MAKE.yari_2[this.heisha_lv];break;case"yumi_1":c=S.MAKE.yumi_1[this.yumiheisha_lv];break;case"yumi_2":c=S.MAKE.yari_2[this.yumiheisha_lv];break;case"uma_1":c=S.MAKE.uma_1[this.kyusha_lv];break;case"uma_2":c=S.MAKE.uma_2[this.kyusha_lv];break;case"heiki_1":c=S.MAKE.heiki_1[this.koubou_lv];break;case"heiki_2":c=S.MAKE.heiki_2[this.koubou_lv];break;case"spy_1":c=S.MAKE.spy_1[this.renpeizyo_lv];break;case"spy_2":c=S.MAKE.spy_2[this.kyusha_lv];break;default:throw'Unknown heishu. [ S.Kyoten.getMakeSec("'+a+'") ]';}return b?c-c*b.getHeiEffect(a,"make"):c},getLabel:function(){if(this.pname){return this.pname}else{return this.isDefault()?undefined:S.UNTITLE_KYOTEN}},isDefault:function(){var i,j;for(i in this){if(this.hasOwnProperty(i)){switch(i){case'renpeizyo_lv':case'heisha_lv':case'yumiheisha_lv':case'kyusha_lv':case'koubou_lv':case'kajiba_lv':case'bouguya_lv':case'kunren_lv':case'ensei_lv':case'pname':if(this[i]){return false}break;case'buki_lvs':case'yoroi_lvs':for(j in this[i]){if(this[i][j]){return false}}break;default:break}}}return true},clear:function(){this.init();this._serialize();this.dispatch('update_k')}})})();S.Effect=(function(){var g=[["IN_ARRAY",["all"].concat(S.HEIKA_KEYS)]],v_in_b_st=[["IN_ARRAY",["atk","def","spd"]]],v_in_hei=[["IN_ARRAY",["all","heiki","spy"].concat(S.HEIKA_KEYS,S.HEISHU_KEYS)]],v_in_st=[["IN_ARRAY",["atk","def","spd","make"]]],v_others=[["IN_ARRAY",S.OTHERS_KEYS]],v_number_10_10=[["NUMBER",-10,10]];return S.sub(function(){this.init()},{init:function(){this.all={atk:0,def:0,spd:0,make:0};this.b={all:{atk:0,def:0,spd:0},ho:{atk:0,def:0,spd:0},yari:{atk:0,def:0,spd:0},yumi:{atk:0,def:0,spd:0},uma:{atk:0,def:0,spd:0}};this.h={all:{atk:0,def:0,spd:0,make:0},ho:{atk:0,def:0,spd:0,make:0},yari:{atk:0,def:0,spd:0,make:0},yumi:{atk:0,def:0,spd:0,make:0},uma:{atk:0,def:0,spd:0,make:0},heiki:{atk:0,def:0,spd:0,make:0},spy:{atk:0,def:0,spd:0,make:0},ken:{atk:0,def:0,spd:0,make:0},yari_1:{atk:0,def:0,spd:0,make:0},yari_2:{atk:0,def:0,spd:0,make:0},yumi_1:{atk:0,def:0,spd:0,make:0},yumi_2:{atk:0,def:0,spd:0,make:0},uma_1:{atk:0,def:0,spd:0,make:0},uma_2:{atk:0,def:0,spd:0,make:0},heiki_1:{atk:0,def:0,spd:0,make:0},heiki_2:{atk:0,def:0,spd:0,make:0},spy_1:{atk:0,def:0,spd:0,make:0},spy_2:{atk:0,def:0,spd:0,make:0}};this.taikyu=this.taikyu_dmg=0;this.others={wood:0,stone:0,iron:0,rice:0,build:0}},clear:function(){var i;for(i in this){if(this.hasOwnProperty(i)&&this[i]){if(typeof this[i]==='object'){arguments.callee.apply(this[i])}else{this[i]=0}}}},set:function(a){switch(a){case"all":var b=$v(arguments[1],v_in_st);this.all[b]=$v(arguments[2],v_number_10_10);return this.all[b];case"b":var c=$v(arguments[1],g);var d=$v(arguments[2],v_in_b_st);this.b[c][d]=$v(arguments[3],v_number_10_10);return this.b[c][d];case"h":var e=$v(arguments[1],v_in_hei);var f=$v(arguments[2],v_in_st);this.h[e][f]=$v(arguments[3],v_number_10_10);return this.h[e][f];case"others":var m=$v(arguments[1],v_others);this.others[m]=$v(arguments[2],v_number_10_10);return this.others[m];default:throw'Unknown property. [ S.Effect.set("'+arguments[0]+'") ]';}},sum:function(){var i;for(i=0;i<arguments.length;i++){if(arguments[i]instanceof S.Effect){this._sum(arguments[i])}}},_sum:function(a){var i;for(i in this){if(this.hasOwnProperty(i)){switch(typeof a[i]){case"object":arguments.callee.apply(this[i],[a[i]]);break;case"number":this[i]+=a[i];break;default:throw"Error! [ S.Effect._sum() ]";}}}},getBushoEffect:function(a,b){$v(a,g);$v(b,v_in_b_st);var r=this.all[b]+this.b.all[b];return(a==='all')?r:r+this.b[a][b]},getHeiEffect:function(a,b){$v(a,v_in_hei);$v(b,v_in_st);var r=this.all[b]+this.h.all[b];if(a!=='all'){r+=this.h[a][b];switch(a){case"ken":r+=this.h.ho[b];break;case"yari_1":case"yari_2":r+=this.h.yari[b];break;case"yumi_1":case"yumi_2":r+=this.h.yumi[b];break;case"uma_1":case"uma_2":r+=this.h.uma[b];break;case"heiki_1":case"heiki_2":r+=this.h.ho[b]+this.h.heiki[b];break;case"spy_1":r+=this.h.ho[b]+this.h.spy[b];break;case"spy_2":r+=this.h.uma[b]+this.h.spy[b];break;default:throw"Error! [ S.getHeiEffect() ]";}}return r},getOthersEffect:function(m){$v(m,v_others);return this.others[m]}})})();S.Simulator=(function(){var d=["atk","def","spd"],h_effect_st_keys=["atk","def","spd","make"],v_num_1_9999=[["NUMBER",1,9999]],v_int_0_5=[["INT",0,5]],v_int_0_8=[["INT",0,8]],v_int_0_20=[["INT",0,20]],go=new S.Offence(),go_a=go.attacker,go_d=go.domestic_busho,go_k=go.kyoten,gd=new S.Deffence(),gd_d=gd.domestic_busho,gd_k=gd.kyoten,eu=new S.Effect(),r={},ro=r.offence={},ro_live_nums=ro.live_nums={},ro_make_secs=ro.make_secs={},ro_others=ro.others={wood:0,stone:0,iron:0,rice:0},ro_effect=ro.effect=new S.Effect(),rd=r.deffence={},rd_live_nums=rd.live_nums={},rd_make_secs=rd.make_secs={},rd_others=rd.others={wood:0,stone:0,iron:0,rice:0},rd_effect=rd.effect=new S.Effect();var f=function(a){if(a<5){return 1}if(a<10){return 0.98}if(a<20){return 0.96}if(a<50){return 0.94}if(a<100){return 0.92}return 0.9};return S.sub(function(){this.init();this.load()},{init:function(){this.kyori=1;this.ryouti_lv=0;this.kyoshu=false;this.offence_ally=0;this.deffence_ally=0;this.offence_rinsetu=0;this.deffence_rinsetu=0;this.offence_kakin=false;this.deffence_kakin=false;if(this.setting){go.init();gd.init();eu.init()}else{this.ubs=[];this.uks=[];this.offence=go;this.deffence=gd;this.effect_u=eu;this.result=r;this.setting={is_memory:0}}},load:function(){var i,joined='';for(i=0;i<10;i++){var a=C.get(S.COOKIE_NAME+i,true);if(a){joined+=a}}var o=joined?JSON.parse(decodeURIComponent(joined)):{};if(o['burasan']){o=o['burasan']}if(o.s){this.setting=o.s}else if(o.setting){this.setting=o.setting}if(L.queryKey['r']){try{this.deserialize(decodeURIComponent(L.queryKey['r']))}catch(e){}}else if(o.l){try{this.deserialize(o.l)}catch(e){}}else if(o.last){try{this.deserialize(o.last)}catch(e){}}if(o.b){var b=o.b.split("~");for(i in b){try{this.ubs.push(new S.Busho(b[i]))}catch(e){}}}else if(o.ubs){for(i in o.ubs){try{this.ubs.push(new S.Busho(o.ubs[i]))}catch(e){}}}if(o.k){var c=o.k.split("~");for(i in c){try{this.uks.push(new S.Kyoten(c[i]))}catch(e){}}}else if(o.uks){for(i in o.uks){try{this.uks.push(new S.Kyoten(o.uks[i]))}catch(e){}}}},save:function(){var a,jl,i,l=0,o={},ubs=[],uks=[],cookies=[];o.s=this.setting;if(o.s.is_memory){o.l=this.serialize()}for(i in this.ubs){ubs.push(this.ubs[i].serialize())}o.b=ubs.join('~');for(i in this.uks){uks.push(this.uks[i].serialize())}o.k=uks.join('~');a=encodeURIComponent(JSON.stringify(o));jl=a.length;if(jl>S.COOKIE_SIZE*S.COOKIE_N){alert('Please decrease data.');throw'data over error';}while(l<jl){cookies.push(a.substr(l,S.COOKIE_SIZE));l+=S.COOKIE_SIZE}for(i=0;i<10;i++){var b=S.COOKIE_NAME+i;if(cookies[i]){C.set(b,cookies[i],'',S.COOKIE_PATH,'Mon, 31-Dec-2029 23:59:59 GMT',true)}else{if(b in C.cookies){C.remove(b)}}}},serialize:function(){return[2,go.serialize(),gd.serialize(),this._serializeParams()].join('~')},_serializeParams:function(){var i,j,n,arr=[2,this.kyori,this.ryouti_lv,this.kyoshu?1:0,this.offence_kakin?1:0,this.deffence_kakin?1:0,this.offence_ally,this.deffence_ally,this.offence_rinsetu,this.deffence_rinsetu];for(i in d){n=eu.b.all[d[i]];arr.push(this._serializeMinus(n))}for(i in S.HEISHU){for(j in h_effect_st_keys){n=eu.h[i][h_effect_st_keys[j]];arr.push(this._serializeMinus(n))}}return arr.join("-")},deserialize:function(a){var b=a.split("~");switch(parseInt(b.shift(),10)){case 1:go.copyFrom(b.shift());gd.copyFrom(b.shift());this.set("kyori",b.shift());this.set("offence_kakin",go.offence_kakin);this.set("deffence_kakin",gd.deffence_kakin);break;case 2:go.copyFrom(b.shift());gd.copyFrom(b.shift());this._deserializeParams(b.shift());break;default:break}},_deserializeParams:function(a){var b=a.split("-"),i,j,k;switch(parseInt(b.shift(),10)){case 2:this.set("kyori",b.shift());this.set("ryouti_lv",b.shift());this.set("kyoshu",b.shift());this.set("offence_kakin",b.shift());this.set("deffence_kakin",b.shift());this.set("offence_ally",b.shift());this.set("deffence_ally",b.shift());this.set("offence_rinsetu",b.shift());this.set("deffence_rinsetu",b.shift());for(i in d){eu.set("b","all",d[i],this._deserializeMinus(b.shift()))}for(j in S.HEISHU){for(k in h_effect_st_keys){eu.set("h",j,h_effect_st_keys[k],this._deserializeMinus(b.shift()))}}break;default:break}},_serializeMinus:function(n){return(n<0)?'!'+(eval(Math.abs(n).toFixed(4))).toString():(eval(n.toFixed(4))).toString()},_deserializeMinus:function(a){try{var b=a.match(/^\!(.*)$/);return b?eval(b[1])*-1:eval(a)}catch(e){return 0}},set:function(a){switch(a){case"kyori":this.kyori=$v(arguments[1],v_num_1_9999);return this.kyori;case"ryouti_lv":this.ryouti_lv=$v(arguments[1],v_int_0_5);return this.ryouti_lv;case"kyoshu":this.kyoshu=arguments[1]-0?true:false;return this.kyoshu;case"offence_kakin":case"deffence_kakin":this[a]=arguments[1]-0?true:false;return this[a];case"offence_ally":case"deffence_ally":this[a]=$v(arguments[1],v_int_0_20);return this[a];case"offence_rinsetu":case"deffence_rinsetu":this[a]=$v(arguments[1],v_int_0_8);return this[a]}},addUserBusho:function(a){this.ubs.push(a);this.dispatch('update_ubs');this.save()},refreshUserBusho:function(a){this.ubs=a;this.dispatch('update_ubs');this.save()},deleteUserBusho:function(a){MJ.deleteByValue(this.ubs,a);this.dispatch('update_ubs');this.save()},addUserKyoten:function(a){this.uks.push(a);this.dispatch('update_uks');this.save()},refreshUserKyoten:function(a){this.uks=a;this.dispatch('update_uks');this.save()},deleteUserKyoten:function(a){MJ.deleteByValue(this.uks,a);this.dispatch('update_uks');this.save()},clear:function(){this.init();this.dispatch('init');this.calc()},calc:function(){try{var i,j,ro_s_ns,rd_s_ns,h_info,go_h_n,gd_h_n,tmp_spd,o_dis,d_dis;for(i in ro_others){ro_others[i]=rd_others[i]=0}ro.exp=rd.exp=0;this.ally=this.offence_ally;this.rinsetu=this.offence_rinsetu;ro.effect_a=go_a.getAttackEffect(this);ro.effect_d=go_d.getDomesticEffect(this);ro.effect_k=go_k.getEffect(this);ro_effect.clear();ro_effect.sum(eu,ro.effect_a,ro.effect_d,ro.effect_k);ro.atk=go.getAtk(ro_effect);if(this.offence_kakin){ro.atk=ro.atk*1.1}this.ally=this.deffence_ally;this.rinsetu=this.deffence_rinsetu;rd.effect_d=gd_d.getDomesticEffect(this);rd.effect_k=gd_k.getEffect(this);rd_effect.clear();rd_effect.sum(eu,rd.effect_d,rd.effect_k);rd.def=gd.getDef(go,rd_effect);if(this.ryouti_lv){rd.def=rd.def*S.RYOUTI[this.ryouti_lv]}if(this.deffence_kakin){rd.def=rd.def*1.1}if(this.kyoshu){ro.songai_rate=1/(1+Math.exp(-3.453878*Math.LOG10E*Math.log(rd.def/ro.atk)));rd.songai_rate=(ro.songai_rate>0.15)?1-ro.songai_rate:1;ro.effect.all.spd+=0.2}else{var a=(ro.atk>rd.def);ro.songai_rate=rd.def?a?Math.pow(rd.def/ro.atk,3/2):1:0;rd.songai_rate=ro.atk?a?1:Math.pow(ro.atk/rd.def,3/2):0}ro_s_ns=ro.songai_nums=go.getSongaiNums(ro.songai_rate);rd_s_ns=rd.songai_nums=gd.getSongaiNums(rd.songai_rate,rd_effect);ro.spd=go_a.getSpd(ro.effect);for(i in S.HEISHU){h_info=S.HEI[i];go_h_n=go.hei_nums[i];gd_h_n=gd.hei_nums[i];ro.exp+=h_info.exp*rd_s_ns[i];rd.exp+=h_info.exp*ro_s_ns[i];ro_live_nums[i]=go_h_n-ro_s_ns[i];rd_live_nums[i]=gd_h_n-rd_s_ns[i];ro_make_secs[i]=go_k.getMakeSec(i,ro_effect)*go_h_n;o_dis=f(go_h_n);for(j in ro_others){ro_others[j]+=Math.round(h_info[j]*o_dis)*go_h_n}if(go_h_n){tmp_spd=h_info.spd*(1+ro.effect.getHeiEffect(i,"spd"));if(!ro.spd||(ro.spd>tmp_spd)){ro.spd=tmp_spd}}}ro.hp=go_a.hp;ro.songai_hp=go_a.getSongaiHp(ro.songai_rate,this.kyoshu);ro.live_hp=ro.hp-ro.songai_hp;ro.send_sec=ro.spd?Math.round(this.kyori/ro.spd*3600):0;ro.exp=Math.round(ro.exp*go_a.toubatu/100);ro.taikyu_dmg=Math.round((ro_effect.taikyu+ro.effect_k.getHeiEffect('heiki_1','atk')+1)*go.hei_nums.heiki_1+(ro_effect.taikyu+ro.effect_k.getHeiEffect('heiki_2','atk')+1)*go.hei_nums.heiki_2+ro_effect.taikyu_dmg);rd.hp=gd_d.hp;rd.songai_hp=gd_d.getSongaiHp(rd.songai_rate,this.kyoshu);rd.live_hp=rd.hp-rd.songai_hp;this.dispatch('update');if(this.setting.is_memory){this.save()}return r}catch(e){alert(e)}}})})();var bv=function(a){return D.getElementById(a)},roText=function(a){roText=(this.textContent!==undefined)?function(s){this.textContent=s}:function(s){this.innerText=s};return roText.call(this,a)},secToTime=function(a){var s=Math.round(a%60);if(s<10){s="0"+s}var b=parseInt(a/60,10);var m=b%60;if(m<10){m="0"+m}var h=parseInt(a/3600,10);return[h,m,s].join(':')};$.fn.sangokuEvent=function(a,b,c){if(b&&c){return this.each(function(){this[a]=c;b.addListener(a,this)})}else{return this.each(function(){this[a]()})}};$.fn.inputWithPMButton=function(c,d,f,g,h,i){return this.each(function(){var a=$('input:eq(0)',this);var b=function(n){try{h(n)}catch(e){a.val((typeof i==='function')?i(e):i)}};a.blur(function(){b($(this).val())});$(this).find('button:eq(0)').addClass('pm_button').incButton({target:a,left_inc:-c,right_inc:-d,min:f,max:g,setter:b});$(this).find('button:eq(1)').addClass('pm_button').incButton({target:a,left_inc:c,right_inc:d,min:f,max:g,setter:b})})};S.begin=function(){try{var u=new S.Simulator(),b,k=u.offence.kyoten;var v=$('#kyoten_editor').hide();var w=$('#busho_editor');var x=w;var y=function(a){if(x!==a){x.hide();a.show();x=a}};var z=$('#bushodas').click(function(){if(z.hasClass('bback')){z.removeClass('bback')}else{z.addClass('bback')}}),_bimg=$('#bimg'),_rare=$('#brare'),_heika=$('#bheika'),dom_mask=bv('bmask'),dom_cost=bv('bcost'),dom_name=bv('bname'),dom_id=bv('bid'),dom_hp=bv('bhp'),dom_atk=bv('batk'),dom_int=bv('bint'),dom_def_ho=bv('bdef_ho'),dom_def_yari=bv('bdef_yari'),dom_def_yumi=bv('bdef_yumi'),dom_def_uma=bv('bdef_uma'),dom_spd=bv('bspd'),dom_bonus=bv('bonus_col'),_bushodas_link=$('#bushodas_link'),bbs_url=_bushodas_link.attr('href'),rare_colors={UR:'#f0f',SR:'#f00',R:'#09f',UC:'#f90',C:'#fff'};var A=function(){var a=b.getImage(),rare=b.getRare();_bimg.css('background-image',a?'url('+a+')':'none');_rare.text(rare).css('color',rare_colors[rare]);_heika.removeClass('ho yari yumi uma').addClass(b.getHeika());roText.call(dom_cost,b.getCost().toFixed(1));roText.call(dom_name,b.getName());roText.call(dom_id,b.getId());if(b.hasBushodas()){_bushodas_link.attr('href',bbs_url+b.getId()).text(b.getRare()+b.getName()+S.LINK_BBS_SURFIX)}else{_bushodas_link.removeAttr('href').text('')}};var B=function(){roText.call(dom_hp,b.hp);roText.call(dom_atk,Math.floor(b.getAtk()));roText.call(dom_int,b.getInt().toFixed(2));roText.call(dom_def_ho,Math.floor(b.getDef('ho')));roText.call(dom_def_yari,Math.floor(b.getDef('yari')));roText.call(dom_def_yumi,Math.floor(b.getDef('yumi')));roText.call(dom_def_uma,Math.floor(b.getDef('uma')));roText.call(dom_spd,b.getSpd().toFixed(1));roText.call(dom_bonus,b.getBonus())};var D=$('#lv_col').inputWithPMButton(1,10,function(){return Math.ceil(b.lv-b.getBonus()/5)},400,function(n){b.set('lv',n);B();b.dispatch('update_blabel');u.calc()},function(e){return b.lv}).find('input:eq(0)')[0];var E=$('#ap_col').inputWithPMButton(1,10,0,function(){return b.ap+b.getBonus()},function(n){b.set('ap',n);B();u.calc()},function(e){return b.ap}).find('input:eq(0)')[0];var F=$('#ip_col').inputWithPMButton(1,10,0,function(){return b.ip+b.getBonus()},function(n){b.set('ip',n);B();u.calc()},function(e){return b.ip}).find('input:eq(0)')[0];var G=$('#dp_col').inputWithPMButton(1,10,0,function(){return b.dp+b.getBonus()},function(n){b.set('dp',n);B();u.calc()},function(e){return b.dp}).find('input:eq(0)')[0];var H=$('#sp_col').inputWithPMButton(1,10,0,function(){return b.sp+b.getBonus()},function(n){b.set('sp',n);B();u.calc()},function(e){return b.sp}).find('input:eq(0)')[0];var I=$('#toubatu_col').inputWithPMButton(1,10,0,500,function(n){b.set('toubatu',n);u.calc()},function(e){return b.toubatu}).find('input:eq(0)')[0];var J=function(){D.value=b.lv;E.value=b.ap;F.value=b.ip;G.value=b.dp;H.value=b.sp;I.value=b.toubatu};var K,_cost_select,_zoku_select,_heika_select;var M=$('#bushodas_select').change(function(){b.set('bushodas',S.Data.bushodas[M.val()]);A();B();b.dispatch('update_blabel');u.calc()});var N={};var O=function(){var a=K.val()||'';var b=_cost_select.val()||'';var c=_zoku_select.val()||'';var d=_heika_select.val()||'';var e=[a,b,c,d].join(',');if(!N[e]){var i,html='';for(i in S.Data.bushodas){var f=S.Data.bushodas[i];var g=f.getRare();if(a&&a!==g){continue}if(b&&b!=f.cost){continue}if(c&&c!==f.getShozoku()){continue}if(d&&d!==f.getHeika()){continue}html+='<option value="'+i+'">'+g+f.name+'</option>'}N[e]=$(html)}M.find('option:gt(0)').remove().end().append(N[e])};K=$('#rare_select').change(O);_cost_select=$('#cost_select').change(O);_zoku_select=$('#zoku_select').change(O);_heika_select=$('#heika_select').change(O);var P=function(){var a=M.find('option[value='+b.getId()+']:first');if(!a.size()){K.find('option:first').attr('selected','selected');_cost_select.find('option:first').attr('selected','selected');_zoku_select.find('option:first').attr('selected','selected');_heika_select.find('option:first').attr('selected','selected').change()}W.setTimeout(function(){M.find('option[value='+b.getId()+']:first').attr('selected','selected')})};var Q=$('#skill_lv_select').change(function(){b.set('skill_lv',Q.val());u.calc()});var R=function(){var i;for(i=1;i<=10;i++){var a=Q.find('option[value='+i+']');if(b.skill&&b.skill.hasStatement(i)){a.removeAttr('disabled')}else{a.attr('disabled','disabled')}if(b.skill_lv===i){a.attr('selected','selected')}}};var T=$('#skill_select').append((function(){var i,html='',domestic_html='';for(i in S.Data.skill){if(S.Data.skill[i].isDomestic()){domestic_html+='<option value="'+i+'">'+S.Data.skill[i].name+'</option>'}else{html+='<option value="'+i+'">'+S.Data.skill[i].name+'</option>'}}return html+'<option>--------</option>'+domestic_html})()).change(function(){b.set('skill',S.Data.skill[T.val()]);R();u.calc()});var U=function(){var a=T.find('option[value='+b.getSkillId()+']:first');if(a.size()){a.attr('selected','selected')}else{T.find('option:first').attr('selected','selected')}};var V=function(a){y(w);if(b!==a){b=a;A();B();J();P();U();R()}};var X=function(a){b.copyFrom(a);A();B();J();P();U();R();u.calc();b.dispatch('update_blabel')};$.fn._createKyotenSelectorAction=function(){var i,args=[],_this=this;for(i=0;i<arguments.length;i++){args.push(arguments[i])}return this.change(function(){k.set.apply(k,args.concat([_this.val()]));u.calc();k.dispatch('update_klabel')})};var Y=$('#kajiba_selector')._createKyotenSelectorAction('kajiba_lv'),_bouguya_selector=$('#bouguya_selector')._createKyotenSelectorAction('bouguya_lv'),_kunren_selector=$('#kunren_selector')._createKyotenSelectorAction('kunren_lv'),_ensei_selector=$('#ensei_selector')._createKyotenSelectorAction('ensei_lv'),_renpeizyo_selector=$('#renpeizyo_selector')._createKyotenSelectorAction('renpeizyo_lv'),_heisha_selector=$('#heisha_selector')._createKyotenSelectorAction('heisha_lv'),_yumiheisha_selector=$('#yumiheisha_selector')._createKyotenSelectorAction('yumiheisha_lv'),_kyusha_selector=$('#kyusha_selector')._createKyotenSelectorAction('kyusha_lv'),_koubou_selector=$('#koubou_selector')._createKyotenSelectorAction('koubou_lv'),_buki_ken_selector=$('#buki_ken_selector')._createKyotenSelectorAction('buki_lvs','ken'),_buki_yari1_selector=$('#buki_yari1_selector')._createKyotenSelectorAction('buki_lvs','yari_1'),_buki_yumi1_selector=$('#buki_yumi1_selector')._createKyotenSelectorAction('buki_lvs','yumi_1'),_buki_uma1_selector=$('#buki_uma1_selector')._createKyotenSelectorAction('buki_lvs','uma_1'),_buki_yari2_selector=$('#buki_yari2_selector')._createKyotenSelectorAction('buki_lvs','yari_2'),_buki_yumi2_selector=$('#buki_yumi2_selector')._createKyotenSelectorAction('buki_lvs','yumi_2'),_buki_uma2_selector=$('#buki_uma2_selector')._createKyotenSelectorAction('buki_lvs','uma_2'),_buki_heiki1_selector=$('#buki_heiki1_selector')._createKyotenSelectorAction('buki_lvs','heiki_1'),_buki_heiki2_selector=$('#buki_heiki2_selector')._createKyotenSelectorAction('buki_lvs','heiki_2'),_yoroi_ken_selector=$('#yoroi_ken_selector')._createKyotenSelectorAction('yoroi_lvs','ken'),_yoroi_yari1_selector=$('#yoroi_yari1_selector')._createKyotenSelectorAction('yoroi_lvs','yari_1'),_yoroi_yumi1_selector=$('#yoroi_yumi1_selector')._createKyotenSelectorAction('yoroi_lvs','yumi_1'),_yoroi_uma1_selector=$('#yoroi_uma1_selector')._createKyotenSelectorAction('yoroi_lvs','uma_1'),_yoroi_yari2_selector=$('#yoroi_yari2_selector')._createKyotenSelectorAction('yoroi_lvs','yari_2'),_yoroi_yumi2_selector=$('#yoroi_yumi2_selector')._createKyotenSelectorAction('yoroi_lvs','yumi_2'),_yoroi_uma2_selector=$('#yoroi_uma2_selector')._createKyotenSelectorAction('yoroi_lvs','uma_2'),_yoroi_heiki1_selector=$('#yoroi_heiki1_selector')._createKyotenSelectorAction('yoroi_lvs','heiki_1'),_yoroi_heiki2_selector=$('#yoroi_heiki2_selector')._createKyotenSelectorAction('yoroi_lvs','heiki_2'),_yoroi_spy1_selector=$('#yoroi_spy1_selector')._createKyotenSelectorAction('yoroi_lvs','spy_1'),_yoroi_spy2_selector=$('#yoroi_spy2_selector')._createKyotenSelectorAction('yoroi_lvs','spy_2');var Z=bv('kyoten_name');var bw=$(Z).keyup(function(){k.set('pname',Z.value);k.dispatch('update_klabel')});var bx=function(){Y.find('option[value='+k.kajiba_lv+']:first').attr('selected','selected');_bouguya_selector.find('option[value='+k.bouguya_lv+']:first').attr('selected','selected');_kunren_selector.find('option[value='+k.kunren_lv+']:first').attr('selected','selected');_ensei_selector.find('option[value='+k.ensei_lv+']:first').attr('selected','selected');_renpeizyo_selector.find('option[value='+k.renpeizyo_lv+']:first').attr('selected','selected');_heisha_selector.find('option[value='+k.heisha_lv+']:first').attr('selected','selected');_yumiheisha_selector.find('option[value='+k.yumiheisha_lv+']:first').attr('selected','selected');_kyusha_selector.find('option[value='+k.kyusha_lv+']:first').attr('selected','selected');_koubou_selector.find('option[value='+k.koubou_lv+']:first').attr('selected','selected');_buki_ken_selector.find('option[value='+k.buki_lvs.ken+']:first').attr('selected','selected');_buki_yari1_selector.find('option[value='+k.buki_lvs.yari_1+']:first').attr('selected','selected');_buki_yumi1_selector.find('option[value='+k.buki_lvs.yumi_1+']:first').attr('selected','selected');_buki_uma1_selector.find('option[value='+k.buki_lvs.uma_1+']:first').attr('selected','selected');_buki_yari2_selector.find('option[value='+k.buki_lvs.yari_2+']:first').attr('selected','selected');_buki_yumi2_selector.find('option[value='+k.buki_lvs.yumi_2+']:first').attr('selected','selected');_buki_uma2_selector.find('option[value='+k.buki_lvs.uma_2+']:first').attr('selected','selected');_buki_heiki1_selector.find('option[value='+k.buki_lvs.heiki_1+']:first').attr('selected','selected');_buki_heiki2_selector.find('option[value='+k.buki_lvs.heiki_2+']:first').attr('selected','selected');_yoroi_ken_selector.find('option[value='+k.yoroi_lvs.ken+']:first').attr('selected','selected');_yoroi_yari1_selector.find('option[value='+k.yoroi_lvs.yari_1+']:first').attr('selected','selected');_yoroi_yumi1_selector.find('option[value='+k.yoroi_lvs.yumi_1+']:first').attr('selected','selected');_yoroi_uma1_selector.find('option[value='+k.yoroi_lvs.uma_1+']:first').attr('selected','selected');_yoroi_yari2_selector.find('option[value='+k.yoroi_lvs.yari_2+']:first').attr('selected','selected');_yoroi_yumi2_selector.find('option[value='+k.yoroi_lvs.yumi_2+']:first').attr('selected','selected');_yoroi_uma2_selector.find('option[value='+k.yoroi_lvs.uma_2+']:first').attr('selected','selected');_yoroi_heiki1_selector.find('option[value='+k.yoroi_lvs.heiki_1+']:first').attr('selected','selected');_yoroi_heiki2_selector.find('option[value='+k.yoroi_lvs.heiki_2+']:first').attr('selected','selected');_yoroi_spy1_selector.find('option[value='+k.yoroi_lvs.spy_1+']:first').attr('selected','selected');_yoroi_spy2_selector.find('option[value='+k.yoroi_lvs.spy_2+']:first').attr('selected','selected');Z.value=k.pname||'';k.dispatch('update_klabel')};$('#kyoten_editor').sangokuEvent('init',u,bx);var by=function(a){y(v);if(k!==a){k=a;bx()}};var bz=function(a){k.copyFrom(a);bx();u.calc();k.dispatch('update_klabel')};$.fn.userPresetList=function(o){var b=this;var c=o.userDataPropertyName,refresh_event_name=o.refreshEventName,label_event_name=o.labelEventName,after_sort=o.afterSort,after_preset_click=o.afterPresetClick;var d=function(a){roText.call(this,a.getLabel())};var f=function(){b.find('li').not(this).removeClass('selected');$(this).addClass('selected');after_preset_click.call(b,this.udata)};return b.sortable({axis:'y',items:'li',stop:function(e,a){var i,l,user_datas=[];for(i=0,l=this.childNodes.length;i<l;i++){user_datas.push(this.childNodes[i].udata)}after_sort.call(b,user_datas)}}).sangokuEvent(refresh_event_name,u,function(){b.empty();var i,user_datas=u[c];for(i in user_datas){var a=user_datas[i];$('<li>'+a.getLabel()+'</li>').appendTo(b).click(f).sangokuEvent(label_event_name,a,d)[0].udata=a}}).sangokuEvent(refresh_event_name).extend({selectedUserData:function(){var a=b.find('li.selected');if(a.size()){return a[0].udata}}})};var bA=$('#busho_presets').userPresetList({userDataPropertyName:'ubs',refreshEventName:'update_ubs',labelEventName:'update_blabel',afterPresetClick:X,afterSort:function(a){u.refreshUserBusho(a)}});$('#create_ubusho').click(function(){if(b&&b.hasBushodas()){u.addUserBusho(new S.Busho(b))}});$('#update_ubusho').click(function(){var a=bA.selectedUserData();if(a){a.copyFrom(b);a.dispatch('update_blabel');u.save()}});$('#delete_ubusho').click(function(){var a=bA.selectedUserData();if(a&&W.confirm(a.getLabel()+S.DELETE_CONFIRM_SURFIX)){u.deleteUserBusho(a)}});var bB=$('#kyoten_presets').userPresetList({userDataPropertyName:'uks',refreshEventName:'update_uks',labelEventName:'update_klabel',afterPresetClick:bz,afterSort:function(a){u.refreshUserKyoten(a)}});$('#create_ukyoten').click(function(){u.addUserKyoten(new S.Kyoten(k))});$('#update_ukyoten').click(function(){var a=bB.selectedUserData();if(a){a.copyFrom(k);a.dispatch('update_klabel');u.save()}});$('#delete_ukyoten').click(function(){var a=bB.selectedUserData();if(a&&W.confirm(a.getLabel()+S.DELETE_CONFIRM_SURFIX)){u.deleteUserKyoten(a)}});var bC=$('#o_attacker_select, #o_domestic_select, #d_domestic_select, #o_kyoten_select, #d_kyoten_select');$.fn._bsel=function(a){var b=this;var c=this.click(function(){V(a);bC.not(this).removeClass('selected hover');b.addClass('selected')}).dblclick(function(){X()}).hover(function(){b.addClass('hover')},function(){bC.removeClass('hover')}).sangokuEvent('update_blabel',a,function(){roText.call(c,a.getLabel()||'--------')}).children('span')[0];return this.sangokuEvent('update_blabel')};$("#o_attacker_select")._bsel(u.offence.attacker).addClass('selected');$("#o_domestic_select")._bsel(u.offence.domestic_busho);$("#d_domestic_select")._bsel(u.deffence.domestic_busho);$.fn._ksel=function(a){var b=this;var c=this.click(function(){by(a);bC.not(this).removeClass('selected hover');b.addClass('selected')}).dblclick(function(){bz()}).hover(function(){b.addClass('hover')},function(){bC.removeClass('hover')}).sangokuEvent('update_klabel',a,function(){roText.call(c,a.getLabel()||'--------')}).children('span')[0];return this.sangokuEvent('update_klabel')};$("#o_kyoten_select")._ksel(u.offence.kyoten);$("#d_kyoten_select")._ksel(u.deffence.kyoten);$.fn._simulatorNPropertySelector=function(a){var b=this;return this.sangokuEvent('init',u,function(){b.find('option[value="'+u[a]+'"]:first').attr('selected','selected')}).change(function(){u.set(a,b.val());u.calc()})};$('#o_ally_select')._simulatorNPropertySelector('offence_ally');$('#o_rinsetu_select')._simulatorNPropertySelector('offence_rinsetu');$('#d_ally_select')._simulatorNPropertySelector('deffence_ally');$('#d_ryouti_select')._simulatorNPropertySelector('ryouti_lv');$.fn._simuratorPropertyCheckbox=function(a){var b=this;return this.sangokuEvent('init',u,function(){if(u[a]){b.attr('checked','checked')}else{b.removeAttr('checked')}}).change(function(){u.set(a,b.attr("checked"));u.calc()})};$('#o_kakin_checkbox')._simuratorPropertyCheckbox('offence_kakin');$('#d_kakin_checkbox')._simuratorPropertyCheckbox('deffence_kakin');$('#kyoshu_checkbox')._simuratorPropertyCheckbox('kyoshu');var bD={ken:0,yari_1:1,yumi_1:2,uma_1:3,yari_2:4,yumi_2:5,uma_2:6,spy_1:7,spy_2:8,heiki_1:9,heiki_2:10};var bE=11;$.fn._resultTable=function(h){var j=this;var k=this.find('tbody:first')[0];var g=u[h],offence_flag=(h==="offence"),status=offence_flag?"atk":"def",target_busho=offence_flag?"attacker":"domestic_busho";var l,_total_def,_taikyu_dmg,_spd,_send_time,_exp,_wood,_stone,_iron,_rice,_wood_per,_stone_per,_iron_per,_rice_per,_build_per;var m=[],update_b=[],input_h=[],input_b=[];var p=function(o){if(o.domElement){var c=o.domElement.getElementsByTagName('td');var d=[];var e;for(e in bD){var f=bD[e];d[f]=o.initHeishuAction?o.initHeishuAction.call(c[f],e):c[f]}d[bE]=o.initBushoAction?o.initBushoAction.call(c[bE]):c[bE];if(o.updateHeishuAction){m.push(function(a,r){var b=bD[a];o.updateHeishuAction.call(d[b],a,r)})}if(o.updateBushoAction){update_b.push(function(a,r){o.updateBushoAction.call(d[bE],a,r)})}if(o.inputAutoHeishuAction){input_h.push(function(a){var b=bD[a];o.inputAutoHeishuAction.call(d[b],a)})}if(o.inputAutoBushoAction){input_h.push(function(){o.inputAutoBushoAction.call(d[bE])})}}};p({domElement:$('tr.hei_num_row:first',k)[0],initHeishuAction:function(b){return $(this).inputWithPMButton(1,100,0,999999,(function(a){return function(n){g.set("hei_nums",a,n);u.calc()}})(b),(function(a){return function(e){return g.hei_nums[b]}})(b)).find('input:first')[0]},initBushoAction:function(){return $(this).inputWithPMButton(1,10,0,100,function(n){g[target_busho].set("hp",n);u.calc()},function(e){return g[target_busho].hp}).find('input:first')[0]},inputAutoHeishuAction:function(a){this.value=g.hei_nums[a]},inputAutoBushoAction:function(){this.value=g[target_busho].hp}});p({domElement:$('tr.user_effect_row:first',k)[0],initHeishuAction:function(b){return $(this).inputWithPMButton(1,0.01,-999,999,(function(a){return function(n){u.effect_u.set('h',a,status,n/100);u.calc()}})(b),(function(a){return function(e){return eval((u.effect_u.getHeiEffect(a,status)*100).toFixed(2))}})(b)).find('input:first')[0]},initBushoAction:function(){return $(this).inputWithPMButton(1,0.01,-999,999,function(n){u.effect_u.set('b','all',status,n/100);u.calc()},function(e){return eval((u.effect_u.getBushoEffect('all',status)*100).toFixed(2))}).find('input:first')[0]},inputAutoHeishuAction:function(a){var b=u.effect_u.getHeiEffect(a,status)*100;this.value=eval(b.toFixed(2))},inputAutoBushoAction:function(){var a=u.effect_u.getBushoEffect('all',status)*100;this.value=eval(a.toFixed(2))}});p({domElement:$('tr.attacker_effect_row:first',k)[0],updateHeishuAction:function(a,r){if(r.effect_a){var b=r.effect_a.getHeiEffect(a,status)*100;roText.call(this,eval(b.toFixed(2))+'%')}else{roText.call(this,'0%')}},updateBushoAction:function(a,r){if(r.effect_a){var b=r.effect_a.getBushoEffect(a,status)*100;roText.call(this,eval(b.toFixed(2))+'%')}else{roText.call(this,'0%')}}});p({domElement:$('tr.domestic_effect_row:first',k)[0],updateHeishuAction:function(a,r){if(r.effect_d){var b=r.effect_d.getHeiEffect(a,status)*100;roText.call(this,eval(b.toFixed(2))+'%')}else{roText.call(this,'0%')}},updateBushoAction:function(a,r){if(r.effect_d){var b=r.effect_d.getBushoEffect(a,status)*100;roText.call(this,eval(b.toFixed(2))+'%')}else{roText.call(this,'0%')}}});p({domElement:$('tr.kyoten_effect_row:first',k)[0],updateHeishuAction:function(a,r){var b=r.effect_k.getHeiEffect(a,status)*100;roText.call(this,eval(b.toFixed(2))+'%')},updateBushoAction:function(a,r){var b=r.effect_k.getBushoEffect(a,status)*100;roText.call(this,eval(b.toFixed(2))+'%')}});p({domElement:$('tr.total_effect_row:first',k)[0],updateHeishuAction:function(a,r){var b=r.effect.getHeiEffect(a,status)*100;roText.call(this,eval(b.toFixed(2))+'%')},updateBushoAction:function(a,r){var b=r.effect.getBushoEffect(a,status)*100;roText.call(this,eval(b.toFixed(2))+'%')}});p({domElement:$('tr.songai_row:first',k)[0],updateHeishuAction:function(a,r){roText.call(this,r.songai_nums[a])},updateBushoAction:function(a,r){roText.call(this,r.songai_hp)}});p({domElement:$('tr.live_row:first',k)[0],updateHeishuAction:function(a,r){roText.call(this,r.live_nums[a])},updateBushoAction:function(a,r){roText.call(this,r.live_hp)}});p({domElement:$('tr.make_row:first',k)[0],updateHeishuAction:function(a,r){roText.call(this,secToTime(r.make_secs[a]))},updateBushoAction:function(a,r){roText.call(this,secToTime(g[target_busho].getRecoverSec(r.live_hp)))}});var q=$('tr.others1_row:first',k);if(q.size()){if(offence_flag){l=q.find('span.total_atk:first');_taikyu_dmg=q.find('span.taikyu_dmg:first');_spd=q.find('span.spd:first');_send_time=q.find('span.send_time:first');_exp=q.find('span.exp:first')}else{_total_def=q.find('span.total_def:first');_exp=q.find('span.exp:first')}}var s=$('tr.others2_row:first',k);if(s.size()){_wood=s.find('span.wood:first');_stone=s.find('span.stone:first');_iron=s.find('span.iron:first');_rice=s.find('span.rice:first');_wood_per=s.find('span.wood_per:first');_stone_per=s.find('span.stone_per:first');_iron_per=s.find('span.iron_per:first');_rice_per=s.find('span.rice_per:first');_build_per=s.find('span.build_per:first')}var t=function(){var i,heishu;for(heishu in S.HEISHU){for(i in input_h){input_h[i](heishu)}}};return j.sangokuEvent('update',u,function(){var i,heishu,heika=g[target_busho].getHeika(),r=u.result[h];for(heishu in S.HEISHU){for(i in m){m[i](heishu,r)}}for(i in update_b){update_b[i](heika,r)}if(q.size()){if(offence_flag){l.text(parseInt(r.atk,10));_taikyu_dmg.text(r.taikyu_dmg);_spd.text(r.spd.toFixed(2));_send_time.text(secToTime(r.send_sec))}else{_total_def.text(parseInt(r.def,10))}_exp.text(r.exp)}if(s.size()){var a=r.others,effect_d=r.effect_d;_wood.text(a.wood);_stone.text(a.stone);_iron.text(a.iron);_rice.text(a.rice);if(effect_d){_wood_per.text(eval((effect_d.getOthersEffect('wood')*100).toFixed(2)));_stone_per.text(eval((effect_d.getOthersEffect('stone')*100).toFixed(2)));_iron_per.text(eval((effect_d.getOthersEffect('iron')*100).toFixed(2)));_rice_per.text(eval((effect_d.getOthersEffect('rice')*100).toFixed(2)));_build_per.text(eval((effect_d.getOthersEffect('build')*100).toFixed(2)))}else{_wood_per.text(0);_stone_per.text(0);_iron_per.text(0);_rice_per.text(0);_build_per.text(0)}}}).sangokuEvent('input_npc',u,t).sangokuEvent('init',u,t)};$('#o_result')._resultTable('offence');$('#d_result')._resultTable('deffence');$('#kyori_input').sangokuEvent('init',u,function(){$(this).val(u.kyori)}).parent().inputWithPMButton(1,0.01,1,9999,function(n){u.set('kyori',n);u.calc()},function(e){return u.kyori});var bF,_npc_options={};var bG=$('#npc_preset_select').append((function(){var i,html='',htmls={};for(i in S.Data.npc){var t=S.Data.npc[i].term;var h='<option value="'+i+'">'+S.Data.npc[i].name+'</option>';htmls[t]=htmls[t]?htmls[t]+h:h;html+=h}bF=$(html);for(i in htmls){_npc_options[i]=$(htmls[i])}return bF})());var bH=function(a){var b=a?_npc_options[a]:bF;bG.find('option:gt(1)').remove().end().append(b)};var bI=$('#npc_term_select').append((function(){var i,html='';for(i in _npc_options){html+='<option value="'+i+'">'+i+S.TERM_SELECT_SERFIX+'</option>'}return html})()).change(function(){var a=bI.val();bH(a);u.setting.term=a;u.save()}).sangokuEvent('init',u,function(){var a=u.setting.term;if(a){bI.find('option[value='+a+']:first').attr('selected','selected');bH(a)}});var bJ=$('#npc_rate_select');$('#npc_input_btn').click(function(){var a;var b=S.Data.npc[bG.val()];if(b){var c=eval(bJ.val());for(a in S.HEISHU){u.deffence.set('hei_nums',a,b.getN(a,u.kyori,c))}}else{if(u.result){for(a in S.HEISHU){u.deffence.set('hei_nums',a,u.result.deffence.live_nums[a])}}}u.calc();u.dispatch('input_npc')});$('#sim_clear').click(function(){u.clear();u.offence.attacker.dispatch('update_blabel');u.offence.domestic_busho.dispatch('update_blabel');u.deffence.domestic_busho.dispatch('update_blabel');u.offence.kyoten.dispatch('update_klabel');u.deffence.kyoten.dispatch('update_klabel')});$('#is_memory').sangokuEvent('init',u,function(){if(u.setting.is_memory){$(this).attr('checked','checked')}else{$(this).removeAttr('checked')}}).change(function(){u.setting.is_memory=$(this).attr('checked')?1:0;u.save()});var bK=$('#sim_ura').hide(),_omote=$('#sim_omote');$('#to_sim_ura').click(function(){_omote.fadeOut('fast',function(){bK.fadeIn('fast');$('#copypaste').val(S.LOCATION+S.TARGET_GAME+'/?r='+u.serialize())})});$('#to_sim_omote').click(function(){bK.fadeOut('fast',function(){_omote.fadeIn('fast')})});$('#to_sim_ura,#to_sim_omote').css({opacity:0.3}).hover(function(){$(this).css({opacity:1})},function(){$(this).css({opacity:0.3})});var bL=S.LOCATION+'my-'+S.TARGET_GAME+'/';$('#my_sim_location').text(bL);$('#my_sim_button').click(function(){var a=$('#my_sim_input').val();if(a){W.location=bL+a+'/'}else{alert('入力してください（///o///）')}});var bM,cur_dir_chopped,dir_m=L.directory.match(/(.*)\/$/);if(dir_m){bM=L.directory;if(bM!=='/'){cur_dir_chopped=dir_m[1]}}else{bM=L.directory+'/';cur_dir_chopped=L.directory}$('#delete_cookie_button').click(function(){if(W.confirm('シミュレータデータを削除します。')){for(i=0;i<10;i++){var a=S.COOKIE_NAME+i;C.remove(a,undefined,bM);if(cur_dir_chopped){C.remove(a,undefined,cur_dir_chopped)}}}});$('#rebuild_cookie_button').click(function(){if(W.confirm('シミュレータデータを再構成します。')){for(i=0;i<10;i++){var a=S.COOKIE_NAME+i;C.remove(a,undefined,bM);if(cur_dir_chopped){C.remove(a,undefined,cur_dir_chopped)}}u.save()}});V(u.offence.attacker);u.dispatch('init');u.calc()}catch(e){alert(e)}};W[br.name]=S})();